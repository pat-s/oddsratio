<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting Started • oddsratio</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">oddsratio</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/oddsratio.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pat-s/oddsratio/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting Started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pat-s/oddsratio/blob/main/vignettes/oddsratio.Rmd" class="external-link"><code>vignettes/oddsratio.Rmd</code></a></small>
      <div class="d-none name"><code>oddsratio.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="prepare-data">Prepare Data<a class="anchor" aria-label="anchor" href="#prepare-data"></a>
</h2>
<p>Data source: <code><a href="https://rdrr.io/pkg/mgcv/man/predict.gam.html" class="external-link">?mgcv::predict.gam</a></code></p>
<p>First, fit a simple GAM model.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/pat-s/oddsratio" class="external-link">"oddsratio"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_gam</span> <span class="op">&lt;-</span> <span class="fu">mgcv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">x1</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="va">x3</span><span class="op">)</span> <span class="op">+</span> <span class="va">x4</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data_gam</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="gam-example">GAM Example<a class="anchor" aria-label="anchor" href="#gam-example"></a>
</h2>
<div class="section level3">
<h3 id="calculating-odds-ratio-for-static-increases-of-a-continuous-variable">Calculating Odds Ratio for Static Increases of a Continuous
Variable<a class="anchor" aria-label="anchor" href="#calculating-odds-ratio-for-static-increases-of-a-continuous-variable"></a>
</h3>
<p>In this example we take predictor <code>x2</code> (randomly chosen).
First we define start and stop values via <code>values</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/or_gam.html">or_gam</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data_gam</span>, model <span class="op">=</span> <span class="va">fit_gam</span>, pred <span class="op">=</span> <span class="st">"x2"</span>,</span>
<span>  values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.099</span>, <span class="fl">0.198</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   predictor value1 value2 oddsratio CI_low (2.5%) CI_high (97.5%)</span></span>
<span><span class="co">#&gt; 1        x2  0.099  0.198  23.32353      23.30424        23.34283</span></span></code></pre></div>
<p>Inspecting the plot we see that the odds of response <code>y</code>
happening are 22 times higher when predictor <code>x2</code> increases
from 0.099 to 0.198, while holding all other predictors constant.</p>
<p>The detailed steps are</p>
<ol style="list-style-type: decimal">
<li>Set all predictors to their mean value</li>
<li>Predict the response,</li>
<li>Change the selected predictor to a new value and predict the
response again.</li>
</ol>
<p>This result in two “log odds” values, which are subsequently
transformed into “odds”. Finally, the odds ratio can be calculated from
these two odds values.</p>
</div>
<div class="section level3">
<h3 id="odds-ratio-for-discrete-variables">Odds ratio for Discrete Variables<a class="anchor" aria-label="anchor" href="#odds-ratio-for-discrete-variables"></a>
</h3>
<p><code><a href="../reference/or_gam.html">or_gam()</a></code> is able to handle factor variables. The levels
which should be be compared need to be passed to
<code>values</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/or_gam.html">or_gam</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data_gam</span>, model <span class="op">=</span> <span class="va">fit_gam</span>,</span>
<span>  pred <span class="op">=</span> <span class="st">"x4"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   predictor value1 value2 oddsratio CI_low (2.5%) CI_high (97.5%)</span></span>
<span><span class="co">#&gt; 1        x4      A      B  1.377537      1.334837        1.421604</span></span></code></pre></div>
<p>Here, the change in odds of <code>y</code> happening if predictor
<code>x4</code> is changing from level <code>A</code> to <code>B</code>
is rather small: an increase in odds of 37.8% can be observed.</p>
</div>
<div class="section level3">
<h3 id="odds-ratio-for-percentage-increases-of-a-continuous-variables">Odds ratio for Percentage increases of a Continuous Variables<a class="anchor" aria-label="anchor" href="#odds-ratio-for-percentage-increases-of-a-continuous-variables"></a>
</h3>
<p>To get an impression of odds ratio changes throughout the complete
range of the smoothing function of the fitted GAM model for a specific
predictor, odds ratios based on percentage steps of the predictors
distribution.</p>
<p>Here we slice predictor <code>x2</code> into five parts by extracting
the predictor values in 20% steps.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/or_gam.html">or_gam</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data_gam</span>, model <span class="op">=</span> <span class="va">fit_gam</span>, pred <span class="op">=</span> <span class="st">"x2"</span>,</span>
<span>  percentage <span class="op">=</span> <span class="fl">20</span>, slice <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   predictor value1 value2 perc1 perc2 oddsratio CI_low (2.5%) CI_high (97.5%)</span></span>
<span><span class="co">#&gt; 1        x2  0.001  0.200     0    20   2510.77       1091.68         5774.53</span></span>
<span><span class="co">#&gt; 2        x2  0.200  0.400    20    40      0.03          0.03            0.03</span></span>
<span><span class="co">#&gt; 3        x2  0.400  0.599    40    60      0.58          0.56            0.60</span></span>
<span><span class="co">#&gt; 4        x2  0.599  0.799    60    80      0.06          0.06            0.06</span></span>
<span><span class="co">#&gt; 5        x2  0.799  0.998    80   100      0.41          0.75            0.22</span></span></code></pre></div>
<p>We can see that there is a high odds ratio reported when increasing
predictor <code>x2</code> from 0.008 to 0.206 while all further
predictor increases decrease the odds of response <code>y</code>
happening substantially.</p>
</div>
<div class="section level3">
<h3 id="plot-gamm-smoothing-functions">Plot GAM(M) Smoothing Functions<a class="anchor" aria-label="anchor" href="#plot-gamm-smoothing-functions"></a>
</h3>
<p><code><a href="../reference/plot_gam.html">plot_gam()</a></code> helps to simplify the plotting of GAM
smoothing functions in R:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_gam.html">plot_gam</a></span><span class="op">(</span><span class="va">fit_gam</span>, pred <span class="op">=</span> <span class="st">"x2"</span>, title <span class="op">=</span> <span class="st">"Predictor 'x2'"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="oddsratio_files/figure-html/unnamed-chunk-6-1.png" width="576" style="display: block; margin: auto;"></p>
<p>You can further customize the look using other colors or line types.
Besides making use of the implemented arguments of the function, you can
save the result of <code><a href="../reference/plot_gam.html">plot_gam()</a></code> to an object and add more
ggplot2 calls afterwards.</p>
</div>
<div class="section level3">
<h3 id="add-odds-ratio-information-into-smoothing-function-plot">Add Odds Ratio Information Into Smoothing Function Plot<a class="anchor" aria-label="anchor" href="#add-odds-ratio-information-into-smoothing-function-plot"></a>
</h3>
<p>So far we computed the odds ratios and created a plot of a GAM
smoothing function. Why not combine both? This is what
<code><a href="../reference/insert_or.html">insert_or()</a></code>aims at. It takes</p>
<ul>
<li>
<code>ggplot</code> plotting object containing the smooth function
and</li>
<li>a [data.frame] returned from <code><a href="../reference/or_gam.html">or_gam()</a></code> containing
information about the predictor and the respective values that should be
inserted.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_object</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_gam.html">plot_gam</a></span><span class="op">(</span><span class="va">fit_gam</span>, pred <span class="op">=</span> <span class="st">"x2"</span>, title <span class="op">=</span> <span class="st">"Predictor 'x2'"</span><span class="op">)</span></span>
<span><span class="va">or_object</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/or_gam.html">or_gam</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data_gam</span>, model <span class="op">=</span> <span class="va">fit_gam</span>,</span>
<span>  pred <span class="op">=</span> <span class="st">"x2"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.099</span>, <span class="fl">0.198</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/insert_or.html">insert_or</a></span><span class="op">(</span><span class="va">plot_object</span>, <span class="va">or_object</span>,</span>
<span>  or_yloc <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  values_xloc <span class="op">=</span> <span class="fl">0.05</span>, arrow_length <span class="op">=</span> <span class="fl">0.02</span>,</span>
<span>  arrow_col <span class="op">=</span> <span class="st">"red"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="oddsratio_files/figure-html/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;"></p>
<p>The odds ratio information is always centered between the two
vertical lines. Hence it only looks nice if the gap between the two
chosen values (here 0.099 and 0.198) is large enough. If the smoothing
line crosses the inserted text, you can correct it by adjusting
<code>or_yloc</code>. This argument sets the y-location of the inserted
odds ratio information.</p>
<p>Depending on the digits of your chosen values (here 3), you might
also need to adjust the x-axis location of the two values so that they
do not interfere with the vertical line.</p>
<p>Let’s do all of this by inserting another odds ratio result into this
plot. This time we simply take the already produced plot as an input to
<code><a href="../reference/insert_or.html">insert_or()</a></code> and use a new odds ratio result:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">or_object2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/or_gam.html">or_gam</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data_gam</span>, model <span class="op">=</span> <span class="va">fit_gam</span>,</span>
<span>  pred <span class="op">=</span> <span class="st">"x2"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/insert_or.html">insert_or</a></span><span class="op">(</span><span class="va">plot</span>, <span class="va">or_object2</span>,</span>
<span>  or_yloc <span class="op">=</span> <span class="fl">2.1</span>, values_yloc <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  line_col <span class="op">=</span> <span class="st">"green4"</span>, text_col <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>  rect_col <span class="op">=</span> <span class="st">"green4"</span>, rect_alpha <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  line_alpha <span class="op">=</span> <span class="fl">1</span>, line_type <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>  arrow_xloc_r <span class="op">=</span> <span class="fl">0.01</span>, arrow_xloc_l <span class="op">=</span> <span class="op">-</span><span class="fl">0.01</span>,</span>
<span>  arrow_length <span class="op">=</span> <span class="fl">0.02</span>, rect <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="oddsratio_files/figure-html/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Using <code>rect = TRUE</code>, you can additionally highlight
certain odds ratio intervals. Aesthetics like opacity or color are fully
customizable.</p>
</div>
</div>
<div class="section level2">
<h2 id="glm-example">GLM Example<a class="anchor" aria-label="anchor" href="#glm-example"></a>
</h2>
<p>Fit model.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">admit</span> <span class="op">~</span> <span class="va">gre</span> <span class="op">+</span> <span class="va">gpa</span> <span class="op">+</span> <span class="va">rank</span>, data <span class="op">=</span> <span class="va">data_glm</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="odds-ratio-for-continuous-predictors">Odds Ratio for Continuous Predictors<a class="anchor" aria-label="anchor" href="#odds-ratio-for-continuous-predictors"></a>
</h3>
<p>For GLMs, the odds ratio calculation is simpler because odds ratio
changes correspond to static predictor increases throughout the complete
value range of each predictor</p>
<p>Hence, [or_glm()] takes the increment steps of each predictor
directly as an input via argument <code>incr</code>. To avoid false
predictor/value assignments, the combinations need to be given in a
named <code>list</code>. Odds ratios of indicator variables are computed
automatically and always refer to the base factor level.</p>
<p>The indicator predictor <code>rank</code> in this example dataset has
four levels. Subsequently, we will get three odds ratio outputs
referring to the base factor level (here: <code>rank1</code>)</p>
<p>The output can be interpreted as follows: “Given <code>rank2</code>
instead of <code>rank1</code> while holding all other values constant
results in a decrease in odds of 49.1% (1-0.509)”.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/or_glm.html">or_glm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_glm</span>, model <span class="op">=</span> <span class="va">fit_glm</span>, incr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>gre <span class="op">=</span> <span class="fl">380</span>, gpa <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   predictor oddsratio ci_low (2.5) ci_high (97.5)          increment</span></span>
<span><span class="co">#&gt; 1       gre     2.364        1.054          5.396                380</span></span>
<span><span class="co">#&gt; 2       gpa    55.712        2.229       1511.282                  5</span></span>
<span><span class="co">#&gt; 3     rank2     0.509        0.272          0.945 Indicator variable</span></span>
<span><span class="co">#&gt; 4     rank3     0.262        0.132          0.512 Indicator variable</span></span>
<span><span class="co">#&gt; 5     rank4     0.212        0.091          0.471 Indicator variable</span></span></code></pre></div>
<p>You can also set other confident intervals for GLM(M) models. The
resulting [data.frame] will automatically adjust the column names to the
specified level.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/or_glm.html">or_glm</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data_glm</span>, model <span class="op">=</span> <span class="va">fit_glm</span>,</span>
<span>  incr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>gre <span class="op">=</span> <span class="fl">380</span>, gpa <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, ci <span class="op">=</span> <span class="fl">0.70</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   predictor oddsratio ci_low (15) ci_high (85)          increment</span></span>
<span><span class="co">#&gt; 1       gre     2.364       1.540        3.647                380</span></span>
<span><span class="co">#&gt; 2       gpa    55.712      10.084      314.933                  5</span></span>
<span><span class="co">#&gt; 3     rank2     0.509       0.366        0.706 Indicator variable</span></span>
<span><span class="co">#&gt; 4     rank3     0.262       0.183        0.374 Indicator variable</span></span>
<span><span class="co">#&gt; 5     rank4     0.212       0.136        0.325 Indicator variable</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://pat-s.me" class="external-link">Patrick Schratz</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
